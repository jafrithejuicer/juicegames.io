<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Juice Games .io</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; background:#cce7ff; }
canvas { display:block; background:#cce7ff; }
#namePopup {
  position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6);
  display:flex; align-items:center; justify-content:center; flex-direction:column;
  font-family:Calibri, sans-serif; color:white; font-size:24px;
}
#nameInput,#colorInput { padding:10px; font-size:20px; border-radius:8px; border:none; margin-top:5px; }
#playBtn { padding:10px 20px; margin-top:10px; background:#4CAF50; color:white; border:none; border-radius:8px; font-size:20px; cursor:pointer; }
#leaderboard {
  position:fixed; top:10px; right:10px; color:white; font-family:Calibri, sans-serif; font-size:16px;
  background:rgba(0,0,0,0.5); padding:10px; border-radius:8px;
}
</style>
</head>
<body>
<div id="namePopup">
  <div>Enter your name</div>
  <input id="nameInput" maxlength="16" placeholder="Name" />
  <input id="colorInput" type="color" value="#ffffff"/>
  <button id="playBtn">Play</button>
</div>
<canvas id="game"></canvas>
<div id="leaderboard"></div>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=900; canvas.height=600;

const MAP_SIZE=5000, BOT_COUNT=20, FOOD_COUNT=7000, BORDER=50;

let keys={}, mouse={x:0,y:0}, player=null, bots=[], food=[], projectiles=[], splitCells=[];

// Utils
function rand(min,max){return Math.random()*(max-min)+min;}
function randColor(){return `hsl(${rand(0,360)},50%,70%)`;}
function randName(){const names=["Nebula","Phantom","Orion","Venom","Nova","Titan","Echo","Rider","Vortex","Comet","Zero","Flash"]; return names[Math.floor(Math.random()*names.length)];}

// Entities
function createPlayer(name,color){return {name,x:MAP_SIZE/2,y:MAP_SIZE/2,size:40,color:color||"#ffffff",speed:3};}
function createBot(){return {name:randName(),x:rand(0,MAP_SIZE),y:rand(0,MAP_SIZE),size:rand(30,70),color:randColor(),speed:1.2};}
function createFood(){return {x:rand(0,MAP_SIZE),y:rand(0,MAP_SIZE),size:rand(3,6),color:randColor()};}

// Init
function init(){
  for(let i=0;i<BOT_COUNT;i++) bots.push(createBot());
  for(let i=0;i<FOOD_COUNT;i++) food.push(createFood());
}

// Input
window.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
window.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);
canvas.addEventListener("mousemove",e=>{
  const rect=canvas.getBoundingClientRect();
  mouse.x=e.clientX-rect.left;
  mouse.y=e.clientY-rect.top;
});

// Update
function update(){
  if(!player) return;

  let speed=player.speed*(40/player.size); // bigger slower
  if(keys['w']) player.y-=speed;
  if(keys['s']) player.y+=speed;
  if(keys['a']) player.x-=speed;
  if(keys['d']) player.x+=speed;

  // Eject towards mouse
  if(keys['e']){
    keys['e']=false;
    let dx=mouse.x-canvas.width/2;
    let dy=mouse.y-canvas.height/2;
    let angle=Math.atan2(dy,dx);
    let shotSize=player.size*0.1;
    projectiles.push({x:player.x,y:player.y,size:shotSize,vx:Math.cos(angle)*10,vy:Math.sin(angle)*10});
    player.size-=shotSize;
  }

  // Split towards mouse
  if(keys[' ']){
    keys[' ']=false;
    let dx=mouse.x-canvas.width/2;
    let dy=mouse.y-canvas.height/2;
    let angle=Math.atan2(dy,dx);
    let newSize=player.size/2;
    splitCells.push({x:player.x,y:player.y,size:newSize,vx:Math.cos(angle)*10,vy:Math.sin(angle)*10});
    player.size=newSize;
  }

  // Eat food
  for(let i=food.length-1;i>=0;i--){
    let f=food[i];
    if(Math.hypot(player.x-f.x,player.y-f.y)<player.size+f.size){
      player.size+=f.size*0.3;
      food.splice(i,1);
    }
  }

  // Bots AI (shivering/fear)
  bots.forEach(b=>{
    let angle=Math.random()*Math.PI*2;
    b.x+=Math.cos(angle)*(b.speed*0.7);
    b.y+=Math.sin(angle)*(b.speed*0.7);

    // Eat food
    for(let i=food.length-1;i>=0;i--){
      let f=food[i];
      if(Math.hypot(b.x-f.x,b.y-f.y)<b.size+f.size){
        b.size+=f.size*0.35;
        food.splice(i,1);
      }
    }

    // Eat player
    let d=Math.hypot(player.x-b.x,player.y-b.y);
    if(d<player.size+b.size){
      if(player.size>b.size*1.1){player.size+=b.size*0.4; Object.assign(b,createBot());}
      else if(b.size>player.size*1.1){ Object.assign(player,createPlayer(player.name,player.color)); }
    }
  });

  // Split cells move and eat bots
  for(let i=splitCells.length-1;i>=0;i--){
    let c=splitCells[i];
    c.x+=c.vx; c.y+=c.vy;
    for(let j=bots.length-1;j>=0;j--){
      let b=bots[j];
      let d=Math.hypot(c.x-b.x,c.y-b.y);
      if(d<c.size+b.size){
        if(c.size>b.size){c.size+=b.size*0.4; Object.assign(b,createBot()); splitCells.splice(i,1); break;}
        else {b.size+=c.size; splitCells.splice(i,1); break;}
      }
    }
  }

  // Projectiles move and hit bots
  for(let i=projectiles.length-1;i>=0;i--){
    let p=projectiles[i];
    p.x+=p.vx; p.y+=p.vy;
    for(let j=bots.length-1;j>=0;j--){
      let b=bots[j];
      if(Math.hypot(p.x-b.x,p.y-b.y)<p.size+b.size){
        if(p.size>b.size){player.size+=b.size*0.4; Object.assign(b,createBot()); projectiles.splice(i,1); break;}
        else {b.size+=p.size; projectiles.splice(i,1); break;}
      }
    }
  }

  // Borders damage
  if(player.x<BORDER||player.x>MAP_SIZE-BORDER||player.y<BORDER||player.y>MAP_SIZE-BORDER) player.size-=0.1;

  // Clamp player
  player.x=Math.max(0,Math.min(MAP_SIZE,player.x));
  player.y=Math.max(0,Math.min(MAP_SIZE,player.y));
}

// Draw
function draw(){
  if(!player) return;
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const offsetX=canvas.width/2-player.x;
  const offsetY=canvas.height/2-player.y;

  // Borders
  ctx.fillStyle="red";
  ctx.fillRect(0+offsetX,0+offsetY,BORDER,MAP_SIZE);
  ctx.fillRect(MAP_SIZE-BORDER+offsetX,0,BORDER,MAP_SIZE);
  ctx.fillRect(0,0+offsetY,MAP_SIZE,BORDER);
  ctx.fillRect(0,MAP_SIZE-BORDER+offsetY,MAP_SIZE,BORDER);

  // Food
  food.forEach(f=>{ctx.fillStyle=f.color; ctx.beginPath(); ctx.arc(f.x+offsetX,f.y+offsetY,f.size,0,Math.PI*2); ctx.fill();});

  // Bots
  bots.forEach(b=>{
    ctx.fillStyle=b.color; ctx.beginPath(); ctx.arc(b.x+offsetX,b.y+offsetY,b.size,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="white"; ctx.font=`14px Calibri`; ctx.textAlign="center"; ctx.fillText(b.name,b.x+offsetX,b.y+offsetY+5);
  });

  // Split cells
  splitCells.forEach(c=>{ctx.fillStyle=player.color; ctx.beginPath(); ctx.arc(c.x+offsetX,c.y+offsetY,c.size,0,Math.PI*2); ctx.fill();});

  // Projectiles
  projectiles.forEach(p=>{ctx.fillStyle=player.color; ctx.beginPath(); ctx.arc(p.x+offsetX,p.y+offsetY,p.size,0,Math.PI*2); ctx.fill();});

  // Player
  ctx.fillStyle=player.color; ctx.beginPath(); ctx.arc(canvas.width/2,canvas.height/2,player.size,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="white"; ctx.font=`14px Calibri`; ctx.textAlign="center"; ctx.fillText(player.name,canvas.width/2,canvas.height/2-10);

  // Leaderboard
  const leaderboard=document.getElementById("leaderboard");
  leaderboard.innerHTML=`<b>Leaderboard</b><br>${player.name}: ${Math.floor(player.size)}`;
}

// Loop
function loop(){update(); draw(); requestAnimationFrame(loop);}

// Play button
document.getElementById("playBtn").onclick=()=>{
  let name=document.getElementById("nameInput").value.trim();
  if(!name) return;
  let color=document.getElementById("colorInput").value;
  player=createPlayer(name,color);
  document.getElementById("namePopup").style.display="none";
  init();
  loop();
};
</script>
</body>
</html>
