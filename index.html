<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Juice Games .io</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; height:100%; background:#fff; }
canvas { display:block; background:#fff; }
#ui { position:fixed; top:10px; left:10px; z-index:100; font-family:Calibri,sans-serif; color:black; }
#colorLabel { display:block; margin-top:5px; font-size:14px; }
#leaderboard { position:fixed; top:10px; right:10px; background:rgba(0,0,0,0.5); padding:10px; border-radius:8px; color:white; font-family:Calibri,sans-serif; font-size:14px; }
#namePopup {
  position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6);
  display:flex; align-items:center; justify-content:center; flex-direction:column;
  font-family:Calibri, sans-serif; color:white; font-size:24px;
}
#nameInput,#colorInput { padding:10px; font-size:20px; border-radius:8px; border:none; margin-top:5px; }
#playBtn { padding:10px 20px; margin-top:10px; background:#4CAF50; color:white; border:none; border-radius:8px; font-size:20px; cursor:pointer; }
</style>
</head>
<body>
<div id="namePopup">
  <div>Enter your name</div>
  <input id="nameInput" maxlength="16" placeholder="Name" />
  <label id="colorLabel">Choose Blob Color:</label>
  <input id="colorInput" type="color" value="#00ccff"/>
  <button id="playBtn">Play</button>
</div>
<canvas id="game"></canvas>
<div id="leaderboard"></div>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth; canvas.height=window.innerHeight;
window.addEventListener('resize',()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});

const MAP_SIZE=50000, BOT_COUNT=50, FOOD_COUNT=15000;
let keys={}, mouse={x:0,y:0}, player=null, bots=[], food=[], projectiles=[], splitCells=[];

// Utils
function rand(min,max){return Math.random()*(max-min)+min;}
function randColor(){return `hsl(${rand(0,360)},50%,70%)`;}
function randName(){const names=["Nebula","Phantom","Orion","Venom","Nova","Titan","Echo","Rider","Vortex","Comet","Zero","Flash"]; return names[Math.floor(Math.random()*names.length)];}

// Entities
function createPlayer(name,color){return {name,x:MAP_SIZE/2,y:MAP_SIZE/2,size:40,color:color||"#00ccff",speed:3,score:0};}
function createBot(){return {name:randName(),x:rand(0,MAP_SIZE),y:rand(0,MAP_SIZE),size:rand(30,70),color:randColor(),speed:1.2,score:0};}
function createFood(){return {x:rand(0,MAP_SIZE),y:rand(0,MAP_SIZE),size:rand(3,6),color:randColor()};}

// Init
function init(){
  for(let i=0;i<BOT_COUNT;i++) bots.push(createBot());
  for(let i=0;i<FOOD_COUNT;i++) food.push(createFood());
}

// Input
window.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
window.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);
canvas.addEventListener("mousemove",e=>{mouse.x=e.clientX; mouse.y=e.clientY;});

// Update
function update(){
  if(!player) return;

  // Movement with size slowdown
  let speed=player.speed*(40/player.size);
  if(keys['w']) player.y-=speed;
  if(keys['s']) player.y+=speed;
  if(keys['a']) player.x-=speed;
  if(keys['d']) player.x+=speed;

  // Eject (E)
  if(keys['e']){
    keys['e']=false;
    let dx=mouse.x-canvas.width/2, dy=mouse.y-canvas.height/2;
    let angle=Math.atan2(dy,dx), shotSize=player.size*0.05;
    projectiles.push({x:player.x,y:player.y,size:shotSize,vx:Math.cos(angle)*15,vy:Math.sin(angle)*15});
    player.size-=shotSize;
    if(player.size<2) Object.assign(player,createPlayer(player.name,player.color));
  }

  // Split (Space)
  if(keys[' ']){
    keys[' ']=false;
    let dx=mouse.x-canvas.width/2, dy=mouse.y-canvas.height/2;
    let angle=Math.atan2(dy,dx), newSize=player.size/2;
    if(newSize>=2){
      splitCells.push({x:player.x,y:player.y,size:newSize,vx:Math.cos(angle)*10,vy:Math.sin(angle)*10,follow:player});
      player.size=newSize;
    } else Object.assign(player,createPlayer(player.name,player.color));
  }

  // Eat food (slower growth)
  for(let i=food.length-1;i>=0;i--){
    let f=food[i];
    if(Math.hypot(player.x-f.x,player.y-f.y)<player.size+f.size){
      player.size+=f.size*0.05; player.score+=Math.floor(f.size*0.05); food.splice(i,1);
    }
    bots.forEach(b=>{
      if(Math.hypot(b.x-f.x,b.y-f.y)<b.size+f.size){b.size+=f.size*0.05; b.score+=Math.floor(f.size*0.05); food.splice(i,1);}
    });
  }

  // Bots behavior
  bots.forEach((b,i)=>{
    if(!b.targetX || Math.random()<0.01){b.targetX=rand(0,MAP_SIZE); b.targetY=rand(0,MAP_SIZE);}
    let dx=b.targetX-b.x; let dy=b.targetY-b.y; let dist=Math.hypot(dx,dy);
    if(dist>1){dx/=dist; dy/=dist; b.x+=dx*b.speed; b.y+=dy*b.speed;}

    // Bots eat each other
    for(let j=bots.length-1;j>=0;j--){
      if(i===j) continue;
      let other=bots[j]; let d=Math.hypot(b.x-other.x,b.y-other.y);
      if(d<b.size+other.size){
        if(b.size>other.size*1.1){b.size+=other.size*0.4; b.score+=Math.floor(other.size*0.4); Object.assign(other,createBot());}
        else if(other.size>b.size*1.1){ Object.assign(b,createBot()); }
      }
    }

    // Bots eat player
    let d=Math.hypot(player.x-b.x,player.y-b.y);
    if(d<player.size+b.size){
      if(player.size>b.size*1.1){player.size+=b.size*0.4; player.score+=Math.floor(b.size*0.4); Object.assign(b,createBot());}
      else if(b.size>player.size*1.1){ Object.assign(player,createPlayer(player.name,player.color)); }
    }
  });

  // Split cells follow player
  for(let i=splitCells.length-1;i>=0;i--){
    let c=splitCells[i];
    let dx=c.follow.x-c.x, dy=c.follow.y-c.y, dist=Math.hypot(dx,dy);
    if(dist>1){dx/=dist; dy/=dist; c.x+=dx*5; c.y+=dy*5;}
    // Kill bots
    bots.forEach((b,j)=>{
      let d=Math.hypot(c.x-b.x,c.y-b.y);
      if(d<c.size+b.size){
        if(c.size>b.size){c.size+=b.size*0.4; Object.assign(b,createBot()); c.follow.size+=b.size*0.4;}
        else {b.size+=c.size; splitCells.splice(i,1);}
      }
    });
    if(c.size<2) splitCells.splice(i,1);
  }

  // Projectiles move
  for(let i=projectiles.length-1;i>=0;i--){
    let p=projectiles[i]; p.x+=p.vx; p.y+=p.vy;
    bots.forEach((b,j)=>{
      if(Math.hypot(p.x-b.x,p.y-b.y)<p.size+b.size){
        if(p.size>b.size){player.size+=b.size*0.4; Object.assign(b,createBot()); projectiles.splice(i,1);}
        else {b.size+=p.size; projectiles.splice(i,1);}
      }
    });
  }

  // Clamp player
  player.x=Math.max(0,Math.min(MAP_SIZE,player.x));
  player.y=Math.max(0,Math.min(MAP_SIZE,player.y));
}

// Draw
function draw(){
  if(!player) return;

  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const offsetX=canvas.width/2-player.x;
  const offsetY=canvas.height/2-player.y;

  // Grid
  ctx.strokeStyle="#eee"; ctx.lineWidth=1;
  for(let x=0;x<MAP_SIZE;x+=50){ctx.beginPath();ctx.moveTo(x+offsetX,0+offsetY);ctx.lineTo(x+offsetX,MAP_SIZE+offsetY);ctx.stroke();}
  for(let y=0;y<MAP_SIZE;y+=50){ctx.beginPath();ctx.moveTo(0+offsetX,y+offsetY);ctx.lineTo(MAP_SIZE+offsetX,y+offsetY);ctx.stroke();}

  // Food
  food.forEach(f=>{ctx.fillStyle=f.color; ctx.beginPath(); ctx.arc(f.x+offsetX,f.y+offsetY,f.size,0,Math.PI*2); ctx.fill();});

  // Bots
  bots.forEach(b=>{
    ctx.fillStyle=b.color; ctx.beginPath(); ctx.arc(b.x+offsetX,b.y+offsetY,b.size,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="white"; ctx.font=`14px Calibri`; ctx.textAlign="center"; ctx.fillText(b.name,b.x+offsetX,b.y+offsetY+5);
  });

  // Split cells
  splitCells.forEach(c=>{ctx.fillStyle=player.color; ctx.beginPath(); ctx.arc(c.x+offsetX,c.y+offsetY,c.size,0,Math.PI*2); ctx.fill();});

  // Projectiles
  projectiles.forEach(p=>{ctx.fillStyle=player.color; ctx.beginPath(); ctx.arc(p.x+offsetX,p.y+offsetY,p.size,0,Math.PI*2); ctx.fill();});

  // Player
  ctx.fillStyle=player.color; ctx.beginPath(); ctx.arc(canvas.width/2,canvas.height/2,player.size,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="black"; ctx.font=`16px Calibri`; ctx.textAlign="center"; ctx.fillText(`${player.name} (${Math.floor(player.size)})`,canvas.width/2,canvas.height/2-10);

  // Leaderboard
  const leaderboard=document.getElementById("leaderboard");
  const all=[player,...bots].sort((a,b)=>b.size-a.size).slice(0,10);
  leaderboard.innerHTML=`<b>Leaderboard</b><br>`;
  all.forEach((p,i)=>leaderboard.innerHTML+=`${i+1}. ${p.name}: ${Math.floor(p.size)}<br>`);
}

// Loop
function loop(){update(); draw(); requestAnimationFrame(loop);}

// Play button
document.getElementById("playBtn").onclick=()=>{
  let name=document.getElementById("nameInput").value.trim();
  if(!name) return;
  let color=document.getElementById("colorInput").value;
  player=createPlayer(name,color);
  document.getElementById("namePopup").style.display="none";
  init();
  loop();
};
</script>
</body>
</html>
