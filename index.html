<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agar.io Clone - Juice Games</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; background:#f0f8ff; font-family:Calibri, sans-serif; color:white; }
canvas { display:block; }

#leaderboard {
  position:absolute; top:20px; left:20px;
  background: rgba(0,0,0,0.5); padding:10px; border-radius:8px; font-size:16px; text-align:left;
}

#minimap {
  position:absolute; bottom:20px; right:20px;
  width:200px; height:150px; background: rgba(0,0,0,0.5); border-radius:8px;
}

#namePopup {
  position: fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center;
  flex-direction:column; font-size:24px;
}
#nameInput { padding:10px; font-size:20px; border-radius:6px; border:none; }
#playBtn { padding:10px 20px; margin-top:10px; background:#4CAF50; border:none; border-radius:6px; cursor:pointer; font-size:20px; color:white; }
#playBtn:hover { background:#45a049; }
</style>
</head>
<body>
<div id="namePopup">
  <div>Enter your name</div>
  <input id="nameInput" maxlength="16" placeholder="Your Name">
  <button id="playBtn">Play</button>
</div>
<div id="leaderboard"></div>
<div id="minimap"></div>
<canvas id="game"></canvas>
<script>
const canvas=document.getElementById("game"), ctx=canvas.getContext("2d");
canvas.width=window.innerWidth; canvas.height=window.innerHeight;

const MAP_SIZE=5000, BOT_COUNT=20, FOOD_COUNT=7000, BORDER_THICKNESS=50, BORDER_COLOR='red';
let player=null, bots=[], food=[], splitCells=[], keys={}, mouseX=0, mouseY=0;

// Utility
function rand(min,max){ return Math.random()*(max-min)+min; }
function randColor(){ return `hsl(${Math.floor(Math.random()*360)},80%,60%)`; }
function randName(){ const n=["Nebula","Phantom","Orion","Venom","Nova","Titan","Echo","Rider","Vortex","Comet","Zero","Flash"]; return n[Math.floor(Math.random()*n.length)]; }

// Entities
function createPlayer(name){ return {name, x:MAP_SIZE/2, y:MAP_SIZE/2, size:40, color:randColor(), speed:3, cells:[{x:MAP_SIZE/2,y:MAP_SIZE/2,size:40}]}; }
function createBot(){ return {name:randName(), x:rand(0,MAP_SIZE), y:rand(0,MAP_SIZE), size:rand(80,300), color:randColor()}; }
function createFood(){ return {x:rand(0,MAP_SIZE), y:rand(0,MAP_SIZE), size:rand(3,8), color:randColor()}; }

// Init
function init(){
  for(let i=0;i<BOT_COUNT;i++) bots.push(createBot());
  for(let i=0;i<FOOD_COUNT;i++) food.push(createFood());
}

// Input
window.addEventListener("mousemove",e=>mouseX=e.clientX);
window.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
window.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

// Movement
function handleMovement(){
  if(!player) return;
  let dx=0, dy=0;
  if(keys['w']) dy-=player.speed; if(keys['s']) dy+=player.speed;
  if(keys['a']) dx-=player.speed; if(keys['d']) dx+=player.speed;
  player.x+=dx; player.y+=dy;
  // border damage
  if(player.x<BORDER_THICKNESS||player.x>MAP_SIZE-BORDER_THICKNESS||player.y<BORDER_THICKNESS||player.y>MAP_SIZE-BORDER_THICKNESS){
    player.size-=0.05;
    if(player.size<6) player.size=40;
  }
}

// Food
function eatFood(){
  for(let i=food.length-1;i>=0;i--){
    let f=food[i];
    let d=Math.hypot(player.x-f.x,player.y-f.y);
    if(d<player.size+f.size){
      player.size+=f.size*0.3; food.splice(i,1);
    }
  }
}

// Bots AI
function botsAI(){
  bots.forEach(b=>{
    let angle=rand(0,Math.PI*2);
    b.x+=Math.cos(angle)*1.5; b.y+=Math.sin(angle)*1.5;
  });
}

// Split/Eject Mechanics
function handleSplitEject(){
  splitCells.forEach((s,i)=>{
    s.x+=s.vx; s.y+=s.vy; s.vx*=0.98; s.vy*=0.98;
    // collide with bots
    for(let j=bots.length-1;j>=0;j--){
      let b=bots[j];
      let d=Math.hypot(s.x-b.x, s.y-b.y);
      if(d<s.size+b.size){
        if(s.size>b.size){ s.size+=b.size*0.4; bots[j]=createBot(); }
        else { b.size+=s.size*0.4; }
      }
    }
  });
  // Remove tiny cells
  splitCells=splitCells.filter(s=>s.size>5);
}

// Player actions
window.addEventListener("keydown",e=>{
  if(!player) return;
  // Eject mass
  if(e.key.toLowerCase()==='e'){
    let angle=Math.atan2(mouseY-canvas.height/2,mouseX-canvas.width/2);
    let mass=player.size*0.1; player.size-=mass;
    splitCells.push({x:player.x, y:player.y, size:mass, vx:Math.cos(angle)*10, vy:Math.sin(angle)*10});
  }
  // Split
  if(e.key===' '){
    let angle=Math.atan2(mouseY-canvas.height/2,mouseX-canvas.width/2);
    let newSize=player.size/2;
    player.size=newSize;
    splitCells.push({x:player.x, y:player.y, size:newSize, vx:Math.cos(angle)*15, vy:Math.sin(angle)*15});
  }
});

// Collisions
function handleCollisions(){
  for(let i=bots.length-1;i>=0;i--){
    let b=bots[i];
    let d=Math.hypot(player.x-b.x,player.y-b.y);
    if(d<player.size+b.size){
      if(player.size>b.size*1.1){ player.size+=b.size*0.4; bots[i]=createBot(); }
      else if(b.size>player.size*1.1){ player=createPlayer(player.name); }
    }
  }
}

// Draw
function draw(){
  if(!player) return;
  let zoom=200/player.size;
  ctx.setTransform(zoom,0,0,zoom,canvas.width/2-player.x*zoom,canvas.height/2-player.y*zoom);
  ctx.clearRect(0,0,canvas.width/zoom,canvas.height/zoom);

  // Borders
  ctx.strokeStyle=BORDER_COLOR; ctx.lineWidth=BORDER_THICKNESS;
  ctx.strokeRect(0,0,MAP_SIZE,MAP_SIZE);

  // Food
  food.forEach(f=>{ ctx.fillStyle=f.color; ctx.beginPath(); ctx.arc(f.x,f.y,f.size,0,Math.PI*2); ctx.fill(); });

  // Bots
  bots.forEach(b=>{
    ctx.fillStyle=b.color; ctx.beginPath(); ctx.arc(b.x,b.y,b.size,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="white"; ctx.font=`${b.size/2}px Calibri`; ctx.textAlign="center"; ctx.fillText(b.name,b.x,b.y+5);
  });

  // Split Cells
  splitCells.forEach(s=>{ ctx.fillStyle='lightgray'; ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fill(); });

  // Player
  ctx.fillStyle=player.color; ctx.beginPath(); ctx.arc(player.x,player.y,player.size,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="white"; ctx.font=`${player.size/2}px Calibri`; ctx.textAlign="center"; ctx.fillText(player.name,player.x,player.y+5);

  drawMinimap();
}

// Leaderboard
function updateLeaderboard(){
  const lb=document.getElementById("leaderboard");
  let list=[...bots]; if(player) list.push(player);
  list.sort((a,b)=>b.size-a.size);
  lb.innerHTML=list.slice(0,5).map((p,i)=>`${i===0?"ðŸ‘‘ ":""}${p.name}: ${Math.floor(p.size)}`).join("<br>");
}

// Minimap
function drawMinimap(){
  const mm=document.getElementById("minimap");
  const mmCtx=mm.getContext('2d');
  mmCtx.clearRect(0,0,mm.width,mm.height);
  const scaleX=mm.width/MAP_SIZE, scaleY=mm.height/MAP_SIZE;
  // Player
  mmCtx.fillStyle='white';
  mmCtx.fillRect(player.x*scaleX-2,player.y*scaleY-2,4,4);
  // Bots
  bots.forEach(b=>{ mmCtx.fillStyle='yellow'; mmCtx.fillRect(b.x*scaleX-2,b.y*scaleY-2,4,4); });
  // Food
  food.slice(0,500).forEach(f=>{ mmCtx.fillStyle='green'; mmCtx.fillRect(f.x*scaleX-1,f.y*scaleY-1,2,2); });
}

// Loop
function loop(){
  handleMovement(); eatFood(); botsAI(); handleSplitEject(); handleCollisions();
  draw(); updateLeaderboard();
  requestAnimationFrame(loop);
}

// Game Start
document.getElementById("playBtn").onclick=()=>{
  let name=document.getElementById("nameInput").value.trim();
  if(!name) return;
  player=createPlayer(name);
  document.getElementById("namePopup").style.display="none";
  init(); loop();
};
</script>
</body>
</html>
